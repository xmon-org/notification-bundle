#!/bin/bash

# Pre-commit hook: ejecuta PHP-CS-Fixer antes de cada commit

echo "üîß Ejecutando PHP-CS-Fixer..."

# Verificar si vendor existe
if [ ! -d "vendor" ]; then
    echo "‚ö†Ô∏è  vendor/ no existe. Ejecuta 'composer install' primero."
    exit 1
fi

# Ejecutar cs-fix solo en archivos staged
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.php$')

if [ -z "$STAGED_FILES" ]; then
    echo "‚úÖ No hay archivos PHP staged, saltando CS-Fixer."
    exit 0
fi

# Ejecutar cs-fix en los archivos staged
echo "$STAGED_FILES" | xargs vendor/bin/php-cs-fixer fix --config=.php-cs-fixer.dist.php --quiet

# Re-a√±adir los archivos arreglados al stage
echo "$STAGED_FILES" | xargs git add

echo "‚úÖ PHP-CS-Fixer completado."
exit 0
